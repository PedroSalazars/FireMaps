<ion-content>

  <!-- TOPBAR -->
  <div class="profile-topbar">
    <div class="topbar-title">
      {{ 'PROFILE.TITLE' | translate }}
    </div>
  </div>

  <!-- LOADING STATE -->
  <div class="profile-wrapper" *ngIf="cargando">
    <div class="profile-inner loading-state">
      <ion-spinner name="crescent"></ion-spinner>
      <p>{{ 'PROFILE.LOADING' | translate }}</p>
    </div>
  </div>

  <!-- PROFILE -->
  <div class="profile-wrapper" *ngIf="!cargando && usuario; else noUsuario">
    <div class="profile-inner">

      <!-- HERO PROFILE -->
      <div class="profile-hero">
        <div class="avatar-circle">
          <span>{{ (usuario.nombre || 'U') | slice:0:1 }}</span>
        </div>

        <div class="hero-text">
          <div class="hero-name">
            {{ usuario.nombre }} {{ usuario.apellidos }}
          </div>
          <div class="hero-role">
            {{ usuario.rol || ( 'PROFILE.DEFAULT_ROLE' | translate ) }}
          </div>
          <div class="hero-company" *ngIf="usuario.compania">
            {{ usuario.compania }}
          </div>
        </div>
      </div>

      <!-- PERSONAL DATA -->
      <div class="profile-card">
        <div class="card-title">{{ 'PROFILE.PERSONAL_DATA' | translate }}</div>

        <div class="info-row">
          <span class="label">{{ 'PROFILE.NAME' | translate }}</span>
          <span class="value">{{ usuario.nombre || '—' }}</span>
        </div>

        <div class="info-row">
          <span class="label">{{ 'PROFILE.LASTNAME' | translate }}</span>
          <span class="value">{{ usuario.apellidos || '—' }}</span>
        </div>

        <div class="info-row">
          <span class="label">{{ 'PROFILE.RUT' | translate }}</span>
          <span class="value">{{ usuario.rut || '—' }}</span>
        </div>

        <div class="info-row">
          <span class="label">{{ 'PROFILE.PHONE' | translate }}</span>
          <span class="value">{{ usuario.telefono || usuario.telefonoMovil || '—' }}</span>
        </div>
      </div>

      <!-- ACCOUNT DATA -->
      <div class="profile-card">
        <div class="card-title">{{ 'PROFILE.ACCOUNT' | translate }}</div>

        <div class="info-row">
          <span class="label">{{ 'PROFILE.EMAIL' | translate }}</span>
          <span class="value">{{ usuario.correo || usuario.email || '—' }}</span>
        </div>

        <div class="info-row">
          <span class="label">{{ 'PROFILE.ROLE' | translate }}</span>
          <span class="value">{{ usuario.rol || '—' }}</span>
        </div>

        <div class="info-row" *ngIf="usuario.compania">
          <span class="label">{{ 'PROFILE.COMPANY' | translate }}</span>
          <span class="value">{{ usuario.compania }}</span>
        </div>

        <div class="info-row" *ngIf="usuario.createdAt?.seconds">
          <span class="label">{{ 'PROFILE.MEMBER_SINCE' | translate }}</span>
          <span class="value">
            {{ usuario.createdAt.seconds * 1000 | date:'dd/MM/yyyy' }}
          </span>
        </div>
      </div>

      <!-- ACTIONS -->
      <div class="profile-card profile-actions">
        <button class="btn-secondary" (click)="goToAjustes()">
          <ion-icon name="settings-outline"></ion-icon>
          <span>{{ 'PROFILE.ACCOUNT_SETTINGS' | translate }}</span>
        </button>

        <button class="btn-danger" (click)="cerrarSesion()">
          <ion-icon name="log-out-outline"></ion-icon>
          <span>{{ 'PROFILE.LOGOUT' | translate }}</span>
        </button>
      </div>

    </div>
  </div>

  <!-- NO USER / ERROR -->
  <ng-template #noUsuario>
    <div class="empty-state" *ngIf="error; else noData">
      <ion-icon name="warning-outline"></ion-icon>
      <p>{{ error }}</p>
    </div>

    <ng-template #noData>
      <div class="empty-state">
        <ion-icon name="person-circle-outline"></ion-icon>
        <p>{{ 'PROFILE.NO_DATA' | translate }}</p>
      </div>
    </ng-template>
  </ng-template>

</ion-content>

<!-- FOOTER -->
<div class="bottom-nav-shell">
  <div class="bottom-nav-mini">
    <button class="bottom-nav-mini-item" (click)="goToNotificaciones()">
      <ion-icon name="notifications-outline"></ion-icon>
      <span>{{ 'FOOTEER.NOTIFICATIONS' | translate }}</span>
    </button>

    <button class="bottom-nav-mini-item" (click)="goToHome()">
      <ion-icon name="home-outline"></ion-icon>
      <span>{{ 'FOOTER.HOME' | translate }}</span>
    </button>

    <button class="bottom-nav-mini-item bottom-nav-mini-item--active" (click)="goToPerfil()">
      <ion-icon name="settings-outline"></ion-icon>
      <span>{{ 'FOOTER.SETTINGS' | translate }}</span>
    </button>
  </div>
</div>
